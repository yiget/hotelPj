var HotelDetailRoomPhotoViewer=function(rname){var photo_sWidth=90,photo_sHeight=50,photo_lHeight=400,photo_lWidth=600;var categoryPhotoArr={},init=function(width,height,option){initCategoryUI();initControllerUI(rname);initHorizontalController();initVerticalController();},setPhoto_sSize=function(width,height){this.photo_sWidth=width;this.photo_sHeight=height;},setPhoto_lSize=function(width,height){this.photo_lWidth=width;this.photo_lHeight=height;},addCategoryPhoto=function(name,photopath_s,photopath_l,category,rid){var photo={name:name,photopath_s:photopath_s,photopath_l:photopath_l,category:category,rid:rid};var photoArr;if(categoryPhotoArr[category]==null){photoArr=new Array();photoArr.push(photo);categoryPhotoArr[category]=photoArr;}
else{photoArr=categoryPhotoArr[category];photoArr.push(photo);}},resize=function(ImgD){if(ImgD.width==this.photo_lWidth&&ImgD.height==this.photo_lHeight){return;}
var image=new Image();image.src=ImgD.src;if(image.width>0&&image.height>0){if(image.width/image.height>=this.photo_lWidth/this.photo_lHeight){if(image.width>this.photo_lWidth){ImgD.width=this.photo_lWidth;ImgD.height=(image.height*this.photo_lWidth)/image.width;}
else{ImgD.width=image.width;ImgD.height=image.height;}}
else{if(image.height>this.photo_lHeight){ImgD.height=this.photo_lHeight;ImgD.width=(image.width*this.photo_lHeight)/image.height;}
else{ImgD.width=image.width;ImgD.height=image.height;}}}},initHorizontalController=function(){var goleft=$j('#roomPhoto-goleft,#roomPhoto-go-left'),goright=$j('#roomPhoto-goright,#roomPhoto-go-right');goleft.click(function(){var photosArea=$j("#roomPhotoHorizontalController div:first");photosArea.scrollLeft(photosArea.scrollLeft()-107);var currentController=$j("#roomphotos a.current");var currentIndex=currentController.parent().index();if(currentIndex!=0){$j("#roomphotos a.current").removeClass("current");var prevController=currentController.parent().prev().children(":first");prevController.addClass("current");var ImageObject=prevController.children(":first");$j("#roomPhotoShowArea img").attr("src",ImageObject.attr("rel"));$j("#roomPhotoShowArea img").attr("rel",ImageObject.attr("rel"));$j("#roomPhotoShowArea img").attr("title",ImageObject.attr("title"));$j("#roomPhotoIndex").html(currentIndex);}
return false;});goright.click(function(){var controllerNum=$j("#roomphotos li").length;var currentController=$j("#roomphotos a.current");var currentIndex=currentController.parent().index();if(controllerNum-currentIndex>5){var photosArea=$j("#roomPhotoHorizontalController div:first");photosArea.scrollLeft(photosArea.scrollLeft()+107);}
if(currentController.parent().index()!=(controllerNum-1)){var nextController=currentController.parent().next().children(":first");$j("#roomphotos a.current").removeClass("current");nextController.addClass("current");var ImageObject=nextController.children(":first");$j("#roomPhotoShowArea img").attr("src",ImageObject.attr("rel"));$j("#roomPhotoShowArea img").attr("rel",ImageObject.attr("rel"));$j("#roomPhotoShowArea img").attr("title",ImageObject.attr("title"));$j("#roomPhotoIndex").html(currentIndex+2);}
return false;});},initVerticalController=function(){$j("#roomPhoto-goup").click(function(){var currentController=$j("#roomPhotoCategory a.current");var photosArea=$j("#roomPhotoCategory").parent();photosArea.scrollTop(photosArea.scrollTop()-31);});$j("#roomPhoto-godown").click(function(){var photosArea=$j("#roomPhotoCategory").parent();photosArea.scrollTop(photosArea.scrollTop()+31);});},initCategoryUI=function(){var categoryHtml="";var index=0;var hotelPhotos=categoryPhotoArr['hotel'];if(hotelPhotos!=null&&hotelPhotos.length>0){categoryHtml+='<li><a href="javascript:;" rid="'+hotelPhotos[0].rid+'" rel="hotel" title="驿站照片">驿站照片<span>（'
+hotelPhotos.length+'）</span></a></li>';}
var hotelManagerPhotos=categoryPhotoArr['hotelManager'];if(hotelManagerPhotos!=null&&hotelManagerPhotos.length>0){categoryHtml+='<li><a href="javascript:;" rid="'+hotelManagerPhotos[0].rid+'" rel="hotelManager" title="店长照片">店长照片<span>（'
+hotelManagerPhotos.length+'）</span></a></li>';}
for(var j=0;j<roomlistorder.length;j++){var categoryname=roomlistorder[j],categoryPhotos=categoryPhotoArr[categoryname];if(categoryPhotos&&categoryPhotos.length>0){if(rname==categoryname){categoryHtml+='<li><a href="javascript:;" class="current" rid="'+categoryPhotoArr[categoryname][0].rid+'" rel="'+categoryname
+'" title="'+categoryname+'">'+categoryname+'<span>（'+categoryPhotoArr[categoryname].length+'）</span></a></li>';}else{categoryHtml+='<li><a href="javascript:;" rid="'+categoryPhotoArr[categoryname][0].rid+'" rel="'+categoryname
+'" title="'+categoryname+'">'+categoryname+'<span>（'+categoryPhotoArr[categoryname].length+'）</span></a></li>';}
index++;}}
if(index>11){$j("#roomupdown").show();$j("#roomPhotoCategory").css("height",index*31);}
$j("#roomPhotoCategory").html(categoryHtml);$j("#roomPhotoCategory a").click({"photos":categoryPhotoArr},function(event){errorMessage("photoviewer-booking");$j("#photoviewer-starttime").removeAttr("disabled");$j("#photoviewer-endtime").removeAttr("disabled");$j("#photoviewer-bookingnumber").removeAttr("disabled");var photoList=event.data.photos[$j(this).attr("rel")];$j("#roomPhotoCategory a.current").removeClass("current");$j(this).addClass("current");$j("#roomphotos").css("width",photoList.length*107);var rid=$j(this).attr("rid");var controllerHtml="";for(var i=0;i<photoList.length;i++){var roomPhoto=photoList[i];if(i==0){controllerHtml+='<li><a class="current">';$j("#roomPhotoShowArea").children(":first").attr("src",roomPhoto.photopath_l);$j("#roomPhotoName").html(roomPhoto.name);}else{controllerHtml+='<li><a>';}
controllerHtml+='<img title="'+roomPhoto.name+'" src="'+roomPhoto.photopath_s+'" rel="'+roomPhoto.photopath_l+'" onload="imgresize(this,90,60)"></a></li>';}
$j("#roomPhotoIndex").html(1);$j("#roomPhotoCount").html(photoList.length);$j("#roomphotos").html(controllerHtml);$j("#roomphotos a").click(function(){var img=$j(this).children(":first");var index=$j(this).parent().index();$j("#roomPhotoShowArea").children(":first").attr("src",img.attr("rel"));$j("#roomphotos a.current").removeClass("current");$j(this).addClass("current");$j("#roomPhotoIndex").html(index+1);});});},initControllerUI=function(categoryName){var controllerHtml="";var photoList=categoryPhotoArr[categoryName];$j("#roomphotos").css("width",photoList.length*107);for(var i=0;i<photoList.length;i++){var roomPhoto=photoList[i];if(i==0){controllerHtml+='<li><a class="current">';$j("#roomPhotoName").html(roomPhoto.name);$j("#roomPhotoIndex").html("1");$j("#roomPhotoCount").html(photoList.length);$j("#roomPhotoShowArea").children(":first").attr("src",roomPhoto.photopath_l);}else{controllerHtml+='<li><a>';}
controllerHtml+='<img class="lazy" src="'+roomPhoto.photopath_s+'" rel="'+roomPhoto.photopath_l+'" title="'+roomPhoto.name+'" onload="imgresize(this,90,60)"></a></li>';}
$j("#roomphotos").html(controllerHtml);$j("#roomphotos a").click({"viewer":this},function(event){var img=$j(this).children(":first");var index=$j(this).parent().index();$j("#roomPhotoShowArea").children(":first").attr("src",img.attr("rel"));$j("#roomphotos a.current").removeClass("current");$j(this).addClass("current");$j("#roomPhotoIndex").html(index+1);});};return{"init":init,"addCategoryPhoto":addCategoryPhoto,"initControllerUI":initControllerUI}};function imgresize(ImgD,photo_lWidth,photo_lHeight){if(ImgD.width==photo_lWidth&&ImgD.height==photo_lHeight){return;}
var image=new Image();image.src=ImgD.src;if(image.width>0&&image.height>0){if(image.width/image.height>=photo_lWidth/photo_lHeight){if(image.width>photo_lWidth){var rate=(image.width-photo_lWidth)/image.width;ImgD.width=photo_lWidth;ImgD.height=image.height-rate*image.height;}
else{ImgD.width=image.width;ImgD.height=image.height;}}
else{if(image.height>photo_lHeight){ImgD.height=photo_lHeight;var rate=(image.height-ImgD.height)/image.height;ImgD.width=image.width-image.width*rate;}
else{ImgD.width=image.width;ImgD.height=image.height;}}}}
function copy_clip(){var $o=$j("#copylinkinput");str=$o.text();$o.select();if(window.clipboardData&&clipboardData.setData){if(clipboardData.setData('text',str)){}else{$j("#copylinkmsg").html("您的浏览器设置不允许脚本访问剪切板").show();}}else{$j("#copylinkmsg").html("您的浏览器不支持脚本复制,请尝试手动复制").show();}}
function showInitTab(tab){var $tab=$j("#tab");if($tab&&$tab.offset()){$j("html,body").animate({scrollTop:$tab.offset().top},500);}}
function anchor(id,offset){var $elem=$j("#"+id);offset=offset||0;if(elem){$j("html,body").animate({scrollTop:$elem.offset().top+offset},500);}}
function getAsk(action){action=action+(action.indexOf("?")==-1?"?":"&")+"t="+new Date().getTime();$j.ajax({url:action,type:'GET',timeout:20000,success:function(msg){$j("#askDiv").html(msg);$j("#askDiv .pageNavi a").click(function(){getAsk($j(this).attr("href"));return false;});$j("#askDiv img.lazy").jail();$j("#asksContainer .pageNavi a").click(function(){$j("html,body").animate({scrollTop:$j("#asks").offset().top-70},500);});}});}
function getReview(action,container){action=action+(action.indexOf("?")==-1?"?":"&")+"t="+new Date().getTime();$j.ajax({url:action,type:'GET',timeout:20000,success:function(msg){$j("#"+container).html(msg);$j("#"+container+" .pageNavi a").click(function(){getReview($j(this).attr("href"),container);return false;});$j("#"+container+" img.lazy").jail();$j("#reviewDiv .pageNavi a").click(function(){$j("html,body").animate({scrollTop:$j("#reviews").offset().top-70},500);});}});}
function checkAskForm(form){$j("#question-errMsg").val("");var question=$j.trim($j("#question").val());if(question=="请在此填写您的住宿预订问题"){question="";}
if(question.length<5){$j("#question-errMsg").html("提问内容至少要有5个字！");return false;}
return true;}
function getReportPageLink(action,container){$j.ajax({url:action,type:'GET',timeout:20000,success:function(msg){$j("#"+container).html(msg);$j("#"+container+" .pageNavi a").click(function(){getReportPageLink($j(this).attr("href"),container);return false;});$j("#"+container+" img.lazy").jail();}});}
function openBigMap(hotelname){if(!$("sb-player")){Shadowbox.load();}
Shadowbox.open({player:"html",content:"",title:hotelname+"位置图",width:800,height:450,options:{onFinish:function(item){if(/^[0-9]+(\.[0-9]+)?$/.test(baiduJd)&&/^[0-9]+(\.[0-9]+)?$/.test(baiduWd)){try{if(window._gmap){var point=new google.maps.LatLng(baiduWd,baiduJd);var map=new google.maps.Map(document.getElementById("sb-player"),{center:point,zoom:14});new google.maps.Marker({position:point,map:map});}
else{var map=new BMap.Map("sb-player");var point=new BMap.Point(baiduJd,baiduWd);map.centerAndZoom(point,14);var marker=new BMap.Marker(point);map.addOverlay(marker);marker.setAnimation(BMAP_ANIMATION_BOUNCE);map.addControl(new BMap.NavigationControl());map.enableScrollWheelZoom();}}catch(e){;}}}}});}
function selectChangeHandler(){getReview('/hotel/ajaxreview.ydd?hid='+hotelid+'&range='+$j('#reviewDiv #range').val()+'&score='+$j('#reviewDiv #score').val()+'&active='+$j('#reviewDiv #active').val(),"reviewDiv");}
function selectChangeHandler_new(){getReview('/hotel/ajaxreview2.ydd?hid='+hotelid+'&range='+$j('#reviewDiv #range').val()+'&score='+$j('#reviewDiv input[name="score"]:checked').val()+'&active='+$j('#reviewDiv #active').val(),"reviewDiv");}
function init(){$j("#starttime").YododoDatePicker({factor:factor,limitFactor:limit,endFactor:factor+1,endtimeLimitFactor:limit+1,endtimeId:"endtime"});$j("#reviewDiv .pageNavi a").click(function(){getReview($j(this).attr("href"),"reviewDiv");return false;});$j("#reportpageDiv .pageNavi a").click(function(){getReportPageLink($j(this).attr("href"),"reportpageDiv");return false;});$j("#hotelInfoToggle").click(function(){var hotelInfoToggleMark=$j("#hotelInfoToggleMark").html();if(hotelInfoToggleMark=="+"){$j("#hotelInfoToggleMark").html("-");$j("#innerlinklist").show();}else{$j("#hotelInfoToggleMark").html("+");$j("#innerlinklist").hide();}});$j("dd a.simg").mouseover(function(){$j(this).siblings("span.bimg").show();}).mouseout(function(){$j(this).siblings("span.bimg").hide();});}
function firstWord2Upper(str){var reg=/\b(\w)|\s(\w)/g;str=str.toLowerCase();return str.replace(reg,function(m){return m.toUpperCase()})}
function showReview(){$j("#reviewDiv").show();$j("#travelReviewContainer").hide();$j("a[id^='reviewTab']").attr("class","current");$j("a[id^='travelReviewTab']").removeAttr("class");$j("#reviewDiv input[name='score']:first").click();}
$j().ready(function(){$j("#reviewDiv input[name='score']:first").attr("checked","checked");});window.onscroll=function(){var scrollTop=document.body.scrollTop|document.documentElement.scrollTop;if(scrollTop>50){$j("#headerRightTop").show();}};$j("a[name^='anchor']").click(function(){var jumpPos;var name=$j(this).attr("name");var cn_tab_top=$j("#cn_hotel_tab").css("top");cn_tab_top=cn_tab_top.substring(0,cn_tab_top.length-2)
var offtop=80;if(cn_tab_top<100){offtop=0;}
$j("a[name^='anchor'].current").removeClass("current");$j("a[name='"+name+"']").addClass("current");if(name=="anchorRoomlist"){jumpPos="roomlist";$j("html,body").animate({scrollTop:$j("#"+jumpPos).offset().top-150},500);return;}else if(name=="anchorHotelinfo"){jumpPos="hotelinfo";}else if(name=="anchorReport"){jumpPos="report";}else if(name=="anchorReviews"){jumpPos="reviews";}else if(name=="anchorAsks"){jumpPos="asks";}else if(name=="anchorTraffic"){jumpPos="traffic";}else if(name.indexOf("anchorHotelTag")>-1){$j("html,body").animate({scrollTop:$j("#hotelTag").offset().top-200},500);return;}
$j("html,body").animate({scrollTop:$j("#"+jumpPos).offset().top-140-offtop},500);return false;});$j("#reviewDiv .pageNavi a").click(function(){$j("html,body").animate({scrollTop:$j("#reviews").offset().top-70},500);});$j("#asksContainer .pageNavi a").click(function(){$j("html,body").animate({scrollTop:$j("#asks").offset().top-70},500);});function addFavorite(hid){$j.post("/favorite/ajaxAddFavorite.ydd",{"id":hid,"type":"h","needQuery":"false"},function(result){if(!result||result==""){alert("收藏失败！");}else{$j("#favorite").hide();$j("#alreadyfavorited").show();}},"json");}
function errorMessage(id,msg){msg=msg||"";$j("#"+id+"-errMsg").html(msg);}
function checkDate(starttime,endtime){var result=true;if(starttime==''){errorMessage("booking","入住日期为空！");result=false;}
if(endtime==''){errorMessage("booking","离开日期为空！");result=false;}
if(result){var beginDate=$j.datepicker.parseDate('yy-mm-dd',$('starttime').value);var endDate=$j.datepicker.parseDate('yy-mm-dd',$('endtime').value);if(endDate.getTime()<=beginDate.getTime()){errorMessage("booking","离开日期不得小于入住日期！");result=false;}
if((endDate.getTime()-beginDate.getTime())/(1000*60*60*24)>15){errorMessage("booking","一次最多预订15天！");result=false;}}
return result;}
var hotelDetailRoomPhotoViewer=null;function openHotelPhoto(hid){if(!hotelDetailRoomPhotoViewer){hotelDetailRoomPhotoViewer=new HotelDetailRoomPhotoViewer("hotel");if(photodatas){for(var categoryKey in photodatas){var photosArray=photodatas[categoryKey];for(var i=0;i<photosArray.length;i++){hotelDetailRoomPhotoViewer.addCategoryPhoto(photosArray[i].name,photosArray[i].photopath_s,photosArray[i].photopath_l,categoryKey,photosArray[i].rid);}}
hotelDetailRoomPhotoViewer.init();showHotelPhoto();}}else{showHotelPhoto();}}
function showHotelPhoto(){var winheight=$j(window).height(),winwidth=$j(window).width();wintop=winheight<470?20:(winheight-450)/2;winleft=(winwidth-800)/2;$j.blockUI({message:$j("#roomphotosviewer"),css:{top:wintop+"px",left:winleft+"px",cursor:'default',border:'none'},overlayCSS:{cursor:'default'}});}
function showReviewBigPic(controller,reviweid){var index=$j(controller).attr("id").replace("review_s_photo_"+reviweid,"");var photoPath=$j(controller).attr("src").replace("_m","");$j("#review_bigphoto_"+reviweid+"_"+index+" img").attr("src",photoPath);$j("#review_bigphoto_"+reviweid+"_"+index).show();}
function hideReviewBigPic(controller,reviweid){var index=$j(controller).attr("id").replace("review_s_photo_"+reviweid,"");$j("#review_bigphoto_"+reviweid+"_"+index).hide();};$j("img.lazy").jail();$j().ready(function(){$j("#SMSExtension").click(function(){$j("#SMSExtensionBox").toggle();});$j("#dj-close").click(function(){$j(this).parent().hide();$j("#sendmsmMsg").text("");$j("#clearPhone").click();});$j("#clearPhone").click(function(){$j(this).siblings().val("");});function changeImg(){var imgSrc=$j("#mvcode").next();var src=imgSrc.attr("src");var timestamp=(new Date()).valueOf();src="/common/verify_code.jsp"+"?timestamp="+timestamp;imgSrc.attr("src",src);}
$j("#sendsms").click(function(){var reg=/^[0-9]*$/;var mobile=$j("#mobile").val();var verifycode=$j("#mvcode").val();var flag=0;if(!reg.test(mobile)||mobile==""||mobile.length!=11){$j("#sendmsmMsg").text("请输入正确的手机号!").show();return;}
if(verifycode==""||verifycode.length!=4){$j("#sendmsmMsg").text("请输入正确的验证码!").show();return;}
$j("#sendmsmMsg").text("正在发送。。。").show();var suid=$j("#sessionSuid").val();var ondutymid=$j("#ondutymid").val();var hid=$j("#hid").val();var rcmdFrom=$j("#rcmdFrom").val();$j.ajax({url:'/hotel/ajaxSendHotelRcmdMsg.ydd?ondutymid='+ondutymid+'&targetHid='+hid+'&rcmdFrom='+rcmdFrom+'&rcmdtype=single',type:'GET',data:'mobile='+mobile+'&verifycode='+verifycode,timeout:10000,error:function(){changeImg();$j("#sendmsmMsg").text("发送失败!").show();},success:function(msg){changeImg();if(msg=='1'){$j("#sendmsmMsg").text("请输入正确的验证码!").show();}else if(msg=='2'){$j("#sendmsmMsg").text("请输入正确的手机号!").show();}else if(msg=='3'){$j("#sendmsmMsg").text("发送失败!").show();}else{$j("#sendmsmMsg").text("已发送!").show();$j("#mobile").val("");}
$j("#mvcode").val("");}});});$j("#closeBar").click(function(){$j(this).parents(".fenxb").hide();});$j("#copylink").click(function(){$j("#copylinkdiv").toggle();$j("#copylinkmsg").html("").hide();});$j("#copylinkdiv .close").click(function(){$j("#copylinkdiv").hide();$j("#copylinkmsg").html("").hide();});});function isFromSearchEngine(){var fromid_cookie=$j.cookie("fromid");var ref_sale_cookie=$j.cookie("ref_sale");var ref_sale2_cookie=$j.cookie("ref_sale2");if((fromid_cookie==null||fromid_cookie.length==0)&&(ref_sale_cookie||ref_sale2_cookie)){if((ref_sale_cookie&&(ref_sale_cookie.indexOf("baidu")>-1||ref_sale_cookie.indexOf("soso")>-1||ref_sale_cookie.indexOf("so.com")>-1||ref_sale_cookie.indexOf("sogou")>-1))||(ref_sale2_cookie&&(ref_sale2_cookie.indexOf("baidu")>-1||ref_sale2_cookie.indexOf("soso")>-1||ref_sale2_cookie.indexOf("so.com")>-1||ref_sale2_cookie.indexOf("sogou")>-1))){return true;}
return false;}}
function seopromRemainNum(){var countpromnum=16;var seopromtime=getcookie("_se_pro_time");var nowtime=new Date().getTime();if(seopromtime){seopromtime=parseInt(seopromtime);if(nowtime<(seopromtime+1000*10)){return countpromnum;}else if(nowtime>=(seopromtime+1000*10)&&nowtime<(seopromtime+1000*30)){return countpromnum-1;}else if(nowtime>=(seopromtime+1000*60)&&nowtime<(seopromtime+1000*90)){return countpromnum-3;}else if(nowtime>=(seopromtime+1000*90)&&nowtime<(seopromtime+1000*150)){return countpromnum-5;}else if(nowtime>=(seopromtime+1000*150)&&nowtime<(seopromtime+1000*300)){return countpromnum-10;}else{return 3;}}else{setCookie("_se_pro_time",nowtime,86400000);return countpromnum;}}